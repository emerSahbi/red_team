---
# Basic configuration of all host devices

# 1) Fix DNS config
- name: Fix DNS config
  copy:
    dest: /etc/resolv.conf
    content: |
      nameserver 8.8.8.8
      nameserver 1.1.1.1

# 2) Try apt update â€” DO NOT fail if Debian Buster repos are broken
- name: Retry apt update with fixed DNS (best effort)
  apt:
    update_cache: yes
  register: apt_result
  retries: 3
  delay: 5
  until: apt_result is success
  ignore_errors: true
  failed_when: false

# 3) Install net-tools (best effort)
- name: Install net-tools (best effort)
  apt:
    name: net-tools
    state: present
  ignore_errors: true
  failed_when: false

# 4) Install unzip (best effort)
- name: Install unzip (best effort)
  apt:
    name: unzip
    state: present
  ignore_errors: true
  failed_when: false

# 5) Install dnsutils (best effort)
- name: Install dnsutils (best effort)
  apt:
    name: dnsutils
    state: present
  ignore_errors: true
  failed_when: false
